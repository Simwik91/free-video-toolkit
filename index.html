<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Convert videos online for free. Create and download converted videos instantly. Simple, fast, and no signup required.">
  <title>Free Video Converter</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- Analytics scripts -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4041775163958551" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LR5XP1GJFC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-LR5XP1GJFC');
  </script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 2em; background: #f4f4f4; color: #333; }
    h1 { font-size: 2em; margin-bottom: 0.2em; }
    p { margin-top: 0; margin-bottom: 2em; color: #666; }
    label, select, button, .drop-zone { display: block; margin: 0.5em auto; width: 90%; max-width: 400px; box-sizing: border-box; }
    select, button { padding: 0.75em; font-size: 1em; border-radius: 6px; border: 1px solid #ccc; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    button { background-color: #007acc; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #005fa3; }
    .drop-zone { padding: 2em; border: 2px dashed #007acc; border-radius: 6px; background: #fff; cursor: pointer; text-align: center; }
    .drop-zone.active { border-color: #005fa3; }
    .progress-bar { width: 90%; max-width: 400px; height: 20px; background: #ccc; border-radius: 10px; margin: 1em auto; overflow: hidden; }
    .progress-fill { height: 100%; width: 0; background: #007acc; border-radius: 10px; }
    footer { margin-top: 3em; font-size: 0.85em; color: #888; }
  </style>
</head>
<body>
  <h1>Free Video Converter</h1>
  <p>Convert your videos online for free. No signup required.</p>

  <div id="dropZone" class="drop-zone">
    <span id="dropZoneText">Drop your video here or click to upload<br>Supported formats: MP4, MOV, AVI, MKV, WEBM<br>Max file size: 100MB</span>
    <input type="file" id="videoInput" accept="video/*" hidden>
  </div>

  <label for="format">Output Format</label>
  <select id="format"><option value="mp4">MP4</option><option value="webm">WEBM</option></select>
  <label for="quality">Quality</label>
  <select id="quality"><option value="high">High</option><option value="medium" selected>Medium</option><option value="low">Low</option></select>
  <label><input type="checkbox" id="mute-audio"> Mute Audio</label>
  <button id="convertBtn" disabled>Convert</button>

  <div id="progressContainer" style="display:none;">
    <p id="progressMessage">Starting conversion...</p>
    <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
    <p id="progressPercent">0%</p>
  </div>

  <div id="resultContainer" style="display:none;"><p>Conversion complete!</p><a id="downloadLink" href="#" download="converted.mp4">Download Converted Video</a></div>

  <footer>Free Video Converter. Made with ❤️</footer>

  <!-- Main logic as ES module using ESM build to avoid CORS issues -->
  <script type="module">
    // Import from the ESM entrypoint (enables proper CORS headers)
    import { createFFmpeg, fetchFile } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/ffmpeg.esm.js';

    const ffmpeg = createFFmpeg({
      log: true,
      // Provide core from same origin to avoid CORS, use jsDelivr which sends CORS headers
      corePath: 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.10/dist/ffmpeg-core.js',
      progress: ({ ratio }) => {
        const pct = Math.round(ratio * 100);
        updateProgress(pct, `Converting: ${pct}%`);
      }
    });

    let uploadedFile = null;
    let conversionInProgress = false;
    // Element references
    const dropZone = document.getElementById('dropZone');
    const videoInput = document.getElementById('videoInput');
    const dropZoneText = document.getElementById('dropZoneText');
    const convertBtn = document.getElementById('convertBtn');
    const progressContainer = document.getElementById('progressContainer');
    const progressMessage = document.getElementById('progressMessage');
    const progressFill = document.getElementById('progressFill');
    const progressPercent = document.getElementById('progressPercent');
    const resultContainer = document.getElementById('resultContainer');
    const downloadLink = document.getElementById('downloadLink');

    // Setup drag/drop and click
    window.addEventListener('load', () => {
      videoInput.addEventListener('change', e => e.target.files[0] && processFile(e.target.files[0]));
      dropZone.addEventListener('click', () => videoInput.click());
      dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('active'); });
      dropZone.addEventListener('dragleave', e => { e.preventDefault(); dropZone.classList.remove('active'); });
      dropZone.addEventListener('drop', e => {
        e.preventDefault();
        dropZone.classList.remove('active');
        e.dataTransfer.files[0] && processFile(e.dataTransfer.files[0]);
      });
      convertBtn.addEventListener('click', startConversion);
    });

    function processFile(file) {
      const allowedTypes = ['video/mp4','video/quicktime','video/x-msvideo','video/x-matroska','video/webm'];
      const ext = '.' + file.name.split('.').pop().toLowerCase();
      if (!allowedTypes.includes(file.type) && !['.mp4','.mov','.avi','.mkv','.webm'].includes(ext)) {
        return alert('Unsupported video format.');
      }
      if (file.size > 100 * 1024 * 1024) return alert('File exceeds 100MB.');
      uploadedFile = file;
      dropZoneText.textContent = `Selected: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
      convertBtn.disabled = false;
    }

    function updateProgress(percent, msg) {
      progressFill.style.width = `${percent}%`;
      progressMessage.textContent = msg;
      progressPercent.textContent = `${percent}%`;
    }

    async function startConversion() {
      if (!uploadedFile || conversionInProgress) return;
      conversionInProgress = true;
      convertBtn.disabled = true;
      progressContainer.style.display = 'block';
      resultContainer.style.display = 'none';

      const format = document.getElementById('format').value;
      const quality = document.getElementById('quality').value;
      const muteAudio = document.getElementById('mute-audio').checked;
      const inputExt = uploadedFile.name.split('.').pop();
      const inputName = `input.${inputExt}`;
      const outputName = `output.${format}`;

      try {
        updateProgress(10, 'Loading FFmpeg...');
        if (!ffmpeg.isLoaded()) await ffmpeg.load();
        updateProgress(30, 'Writing file...');
        ffmpeg.FS('writeFile', inputName, await fetchFile(uploadedFile));

        const args = ['-i', inputName];
        if (quality === 'high') args.push('-crf', '18');
        else if (quality === 'medium') args.push('-crf', '23');
        else if (quality === 'low') args.push('-crf', '28');
        if (muteAudio) args.push('-an');
        args.push(outputName);

        updateProgress(50, 'Converting...');
        await ffmpeg.run(...args);
        updateProgress(90, 'Preparing download...');

        const data = ffmpeg.FS('readFile', outputName);
        const blob = new Blob([data.buffer], { type: `video/${format}` });
        const url = URL.createObjectURL(blob);
        downloadLink.href = url;
        downloadLink.download = `converted.${format}`;
        resultContainer.style.display = 'block';
        updateProgress(100, 'Done');
      } catch (e) {
        console.error(e);
        alert('Conversion error.');
      } finally {
        conversionInProgress = false;
        convertBtn.disabled = false;
      }
    }
  </script>
</body>
</html>
